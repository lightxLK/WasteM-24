<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="favicon\android-chrome-512x512.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Waste Report - Waste Management System</title>
    <style>
        /* Basic styling for structure */
        body {
            font-family: Cambria, serif;
            margin: 20px;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        h1, h2, h3 {
            text-align: center;
        }
        #content {
            max-width: 800px;
            margin: 0 auto;
        }
        form {
            margin: 0 auto 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover {
            background-color: #45a049;
        }
        /* Table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        tfoot {
            font-weight: bold;
        }
    </style>
    <script src="script.js" defer></script>
</head>
<body>

    <!-- Header Section -->
    <header>
        <h1><a href="index.html" id="home-link" style="text-decoration: none; color: inherit;">Waste Management System</a></h1>
    </header>

    <!-- Reports Generation Section -->
    <div id="content">
        <h2>Generate Waste Report</h2>
        <p>Select the type of report you want to generate and fill in the necessary details.</p>

        <form id="reports-form">
            <h3>Select Report Type</h3>
            <div class="form-group">
                <label>
                    <input type="radio" name="report_type" value="date_range" checked>
                    Date Range
                </label>
                <input type="date" id="from_date" required>
                <input type="date" id="to_date" required>
            </div>
            <div class="form-group">
                <label>
                    <input type="radio" name="report_type" value="month">
                    Month
                </label>
                <select id="month" disabled>
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
            </div>
            <button type="submit">Generate Report</button>
        </form>

        <h3>Report Results</h3>
        <table id="reports-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Food Waste (kg)</th>
                    <th>Recycled Water (liters)</th>
                    <th>Solid Waste (kg)</th>
                    <th>Wet Waste (kg)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated here -->
            </tbody>
            <tfoot>
                <tr>
                    <td><strong>Total</strong></td>
                    <td id="total_food_waste">0</td>
                    <td id="total_recycled_water">0</td>
                    <td id="total_solid_waste">0</td>
                    <td id="total_wet_waste">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
        // Enable/disable input fields based on selected radio button
        document.querySelectorAll('input[name="report_type"]').forEach((input) => {
            input.addEventListener('change', function () {
                document.getElementById('from_date').disabled = this.value !== 'date_range';
                document.getElementById('to_date').disabled = this.value !== 'date_range';
                document.getElementById('month').disabled = this.value === 'date_range';
            });
        });

        // Handle form submission
        document.getElementById('reports-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const reportType = document.querySelector('input[name="report_type"]:checked').value;
            let data = { type: reportType };

            if (reportType === 'date_range') {
                data.from_date = document.getElementById('from_date').value;
                data.to_date = document.getElementById('to_date').value;
            } else {
                data.month = document.getElementById('month').value;
            }

            // Fetch the report data
            fetch('generate_report.php', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#reports-table tbody');
                tbody.innerHTML = ''; // Clear previous results

                if (data.success) {
                    let totalFoodWaste = 0;
                    let totalRecycledWater = 0;
                    let totalSolidWaste = 0;
                    let totalWetWaste = 0;

                    data.reports.forEach(report => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${report.date}</td>
                            <td>${report.food_waste}</td>
                            <td>${report.recycled_water}</td>
                            <td>${report.solid_waste}</td>
                            <td>${report.wet_waste}</td>
                        `;
                        tbody.appendChild(row);

                        // Sum up totals
                        totalFoodWaste += parseInt(report.food_waste);
                        totalRecycledWater += parseInt(report.recycled_water);
                        totalSolidWaste += parseInt(report.solid_waste);
                        totalWetWaste += parseInt(report.wet_waste);
                    });

                    // Update totals in footer
                    document.getElementById('total_food_waste').innerText = totalFoodWaste;
                    document.getElementById('total_recycled_water').innerText = totalRecycledWater;
                    document.getElementById('total_solid_waste').innerText = totalSolidWaste;
                    document.getElementById('total_wet_waste').innerText = totalWetWaste;
                } else {
                    alert(data.message); // Show any error message
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>

</body>
</html>